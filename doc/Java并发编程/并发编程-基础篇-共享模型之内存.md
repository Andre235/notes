## 共享模型之内存

#### 本章内容

上一张讲解的monitor主要关注的多线程访问共享变量时，保证临界区代码的原子性

这一章节我们进一步深入学习共享变量在多线程之间的**可见性**问题、以及多条指令执行时的**顺序性**问题

#### Java内存模型

JMM即Java Memory Model，它定义了**主存**（共享数据例如成员变量）、**工作内存**（线程私有数据：局部变量）的抽象概念，底层对应着CPU寄存器、缓存、硬件内存、CPU指令优化等等

JMM主要体现在以下三个方面

1. 原子性

   保证指令执行的原子性，不会受到线程上下文切换的影响

2. 可见性

   保证指令不会受CPU缓存的影响

3. 有序性

   保证指令不会受CPU指令并行优化的影响

##### 子线程退出循环失败

```java
@Slf4j(topic = "Test1")
public class Test1 {

    private static boolean flag = true;
    public static void main(String[] args) throws InterruptedException {
        new Thread(() -> {
            while (flag) {
                log.info("子线程执行");
            }
        }).start();

        TimeUnit.SECONDS.sleep(1);
        log.info("主线程停止子线程");
        flag = false;
    }
}
```



